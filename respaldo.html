<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Hechos de Tránsito — GELM SYSTEM 2026</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
body{margin:0;font-family:system-ui;background:radial-gradient(circle at top,#24002b,#060012);color:#e9f9ff}
.shell{max-width:1280px;margin:20px auto;padding:14px}
.panel{background:rgba(3,5,20,.96);border-radius:24px;padding:18px;box-shadow:0 0 40px rgba(0,234,255,.35)}
h1{text-align:center;color:#00ffc8;margin:0}
.sub{text-align:center;font-size:.85rem;color:#9cb3d8}
.by{text-align:center;color:#00eaff;letter-spacing:.2em;font-size:.75rem}
.card{background:#020616;border-radius:18px;padding:14px;margin:16px 0}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.span2{grid-column:span 2}.full{grid-column:1/-1}
@media (max-width:768px){.grid{grid-template-columns:1fr}.span2{grid-column:1/-1}}
label{font-size:.7rem;color:#9cb3d8;text-transform:uppercase}
input,select,textarea{width:100%;padding:12px;border-radius:14px;border:1px solid #00eaff;background:#020616;color:#fff}
textarea{min-height:110px}
.firmas-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media (max-width:768px){.firmas-grid{grid-template-columns:1fr}}
.firma-box{width:100%;aspect-ratio:3/1.4;background:#fff;border-radius:14px;border:2px dashed #00ffc8}
.firma-box canvas{width:100%;height:100%;touch-action:none}
.fotos-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media (max-width:768px){.fotos-grid{grid-template-columns:1fr}}
.foto-prev{width:100%;border-radius:14px;border:1px solid #00eaff;min-height:120px;object-fit:cover;background:#020616}
.actions{display:flex;flex-wrap:wrap;gap:10px;justify-content:space-between}
button{border-radius:999px;padding:12px 22px;border:none;cursor:pointer;font-weight:700;background:linear-gradient(135deg,#00eaff,#00ffc8,#b300ff);color:#020510}
.danger{background:linear-gradient(135deg,#ff0044,#ff7a3c);color:#fff}
table{width:100%;border-collapse:collapse;font-size:.8rem}
thead{background:linear-gradient(90deg,#00ffc8,#00eaff);color:#020510}
th,td{padding:8px;border-bottom:1px solid #333}
tbody tr:nth-child(even){background:rgba(0,255,200,.05)}
footer{text-align:center;font-size:.75rem;color:#9cb3d8;margin-top:20px}
</style>
</head>
<body>
<div class="shell"><div class="panel">
<h1>HECHOS DE TRÁNSITO</h1>
<div class="sub">GELM-SYSTEM-2026 — PMT Chimaltenango</div>
<div class="by">== SISTEMA OFICIAL ==</div>

<div class="card">
<div class="grid">
<div><label>Fecha</label><input type="date" id="fecha"></div>
<div><label>Hora</label><input type="time" id="hora"></div>
<div class="span2"><label>Tipo de Hecho</label>
<select id="tipo"><option>Colisión Simple</option><option>Colisión Múltiple</option><option>Atropello</option><option>Daños Materiales</option></select></div>
</div>
<label>Dirección</label><input id="direccion">
</div>

<div class="card">
<h3>Vehículo A</h3>
<div class="grid">
<input id="a_placa" placeholder="Placa">
<input id="a_tipo" placeholder="Tipo">
<input id="a_marca" placeholder="Marca">
<input id="a_color" placeholder="Color">
</div>
<h4>Conductor A</h4>
<div class="grid">
<input id="a_nombre" placeholder="Nombre completo">
<select id="a_lic_tipo"><option>A</option><option>B</option><option>C</option><option>M</option><option>E</option><option>NO POSEE</option></select>
<input id="a_licencia" placeholder="Licencia">
<input id="a_documento" placeholder="Documento">
</div>
</div>

<div class="card">
<h3>Vehículo B</h3>
<div class="grid">
<input id="b_placa" placeholder="Placa">
<input id="b_tipo" placeholder="Tipo">
<input id="b_marca" placeholder="Marca">
<input id="b_color" placeholder="Color">
</div>
<h4>Conductor B</h4>
<div class="grid">
<input id="b_nombre" placeholder="Nombre completo">
<select id="b_lic_tipo"><option>A</option><option>B</option><option>C</option><option>M</option><option>E</option><option>NO POSEE</option></select>
<input id="b_licencia" placeholder="Licencia">
<input id="b_documento" placeholder="Documento">
</div>
</div>

<div class="card">
<h3>Agente PMT</h3>
<div class="grid">
<input id="agente_nombre" placeholder="Nombre del Agente">
<input id="agente_chapa" placeholder="Chapa">
</div>
</div>

<div class="card"><h3>Nota / Acuerdo</h3><textarea id="nota"></textarea></div>

<div class="card">
<h3>Fotografías</h3>
<div class="fotos-grid">
<div><input type="file" accept="image/*" onchange="loadFoto(this,'foto1')"><img id="foto1" class="foto-prev"></div>
<div><input type="file" accept="image/*" onchange="loadFoto(this,'foto2')"><img id="foto2" class="foto-prev"></div>
</div>
</div>

<div class="card">
<h3>Firmas</h3>
<div class="firmas-grid">
<div class="firma-box"><canvas id="sigA"></canvas></div>
<div class="firma-box"><canvas id="sigB"></canvas></div>
</div>
</div>

<div class="actions">
<button onclick="guardar()">Guardar</button>
<button onclick="exportarPDF()">PDF</button>
<button onclick="exportarWord()">Word</button>
<button onclick="exportarExcel()">Excel</button>
<button class="danger" onclick="borrar()">Borrar todo</button>
</div>

<div class="card">
<table><thead><tr><th>Fecha</th><th>Hora</th><th>Tipo</th><th>Placa A</th><th>Placa B</th></tr></thead>
<tbody id="tabla"></tbody></table>
</div>

<footer>© 2026 — GELM SYSTEM — PMT</footer>
</div></div>

<script>
const KEY="GELM:HECHOS:2026:PMT";
const SHEETS_URL="https://script.google.com/macros/s/AKfycbzlhmDTLTnP75gyuewDJcD1F6sS2JVTLk9CkamyrIPhs458zJ3zlNat_xdXO20IOHDh4g/exec";
let db=JSON.parse(localStorage.getItem(KEY)||"[]");

function firma(id){
 const c=document.getElementById(id),ctx=c.getContext("2d");let d=false;
 function r(){c.width=c.offsetWidth;c.height=c.offsetHeight;ctx.lineWidth=2;ctx.lineCap='round'}
 r();window.addEventListener("resize",r);
 c.onpointerdown=e=>{d=true;ctx.beginPath();ctx.moveTo(e.offsetX,e.offsetY)}
 c.onpointermove=e=>{if(d){ctx.lineTo(e.offsetX,e.offsetY);ctx.stroke()}}
 window.onpointerup=()=>d=false;
}
firma("sigA");firma("sigB");

function loadFoto(i,id){const f=i.files[0];if(!f)return;const r=new FileReader();r.onload=e=>document.getElementById(id).src=e.target.result;r.readAsDataURL(f);}

function guardar(){
 if(!fecha.value||!a_placa.value){alert("Datos obligatorios");return;}
 const r={fecha:fecha.value,hora:hora.value,tipo:tipo.value,direccion:direccion.value,
 a:{placa:a_placa.value,tipo:a_tipo.value,marca:a_marca.value,color:a_color.value,nombre:a_nombre.value,lic:a_licencia.value,doc:a_documento.value},
 b:{placa:b_placa.value,tipo:b_tipo.value,marca:b_marca.value,color:b_color.value,nombre:b_nombre.value,lic:b_licencia.value,doc:b_documento.value},
 agente:{nombre:agente_nombre.value,chapa:agente_chapa.value},
 nota:nota.value,foto1:foto1.src||"",foto2:foto2.src||"",firmaA:sigA.toDataURL(),firmaB:sigB.toDataURL(),creado:new Date().toISOString()};
 db.push(r);localStorage.setItem(KEY,JSON.stringify(db));render();
 fetch(SHEETS_URL,{method:"POST",mode:"no-cors",body:JSON.stringify(r)});
}

function render(){tabla.innerHTML=db.map(x=>`<tr><td>${x.fecha}</td><td>${x.hora||""}</td><td>${x.tipo}</td><td>${x.a.placa}</td><td>${x.b.placa}</td></tr>`).join("");}
render();

function exportarPDF(){
 const {jsPDF}=window.jspdf;const r=db.at(-1);if(!r)return;const d=new jsPDF();let y=20;
 d.text("HECHOS DE TRÁNSITO — GELM 2026",105,y,{align:"center"});y+=10;
 d.text(`Fecha: ${r.fecha} Hora: ${r.hora}`,20,y);y+=8;
 d.text(`Tipo: ${r.tipo}`,20,y);y+=8;
 d.text(`Dirección: ${r.direccion}`,20,y);y+=8;
 d.text(`Vehículo A: ${r.a.placa} ${r.a.marca} ${r.a.color}`,20,y);y+=6;
 d.text(`Conductor A: ${r.a.nombre} Lic:${r.a.lic}`,20,y);y+=8;
 d.text(`Vehículo B: ${r.b.placa} ${r.b.marca} ${r.b.color}`,20,y);y+=6;
 d.text(`Conductor B: ${r.b.nombre} Lic:${r.b.lic}`,20,y);y+=8;
 if(r.foto1)d.addImage(r.foto1,"JPEG",20,y,70,40);
 if(r.foto2)d.addImage(r.foto2,"JPEG",110,y,70,40);
 y+=50;d.addImage(r.firmaA,"PNG",20,y,70,30);d.addImage(r.firmaB,"PNG",120,y,70,30);
 d.save("HECHOS_GELM_2026.pdf");
}

function exportarWord(){
 const r=db.at(-1);if(!r)return;
 const t=`HECHOS DE TRÁNSITO\nFecha:${r.fecha} Hora:${r.hora}\nTipo:${r.tipo}\nDirección:${r.direccion}\n\nVEHÍCULO A\nPlaca:${r.a.placa} Marca:${r.a.marca} Tipo:${r.a.tipo} Color:${r.a.color}\nConductor:${r.a.nombre} Lic:${r.a.lic} Doc:${r.a.doc}\n\nVEHÍCULO B\nPlaca:${r.b.placa} Marca:${r.b.marca} Tipo:${r.b.tipo} Color:${r.b.color}\nConductor:${r.b.nombre} Lic:${r.b.lic} Doc:${r.b.doc}\n\nAGENTE PMT\n${r.agente.nombre} Chapa:${r.agente.chapa}\n\nNOTA\n${r.nota}`;
 const b=new Blob([t],{type:"application/msword"});const a=document.createElement("a");
 a.href=URL.createObjectURL(b);a.download="HECHOS_GELM_2026.doc";a.click();
}

function exportarExcel(){
 const ws=XLSX.utils.json_to_sheet(db);const wb=XLSX.utils.book_new();
 XLSX.utils.book_append_sheet(wb,ws,"Hechos");XLSX.writeFile(wb,"HECHOS_GELM_2026.xlsx");
}

function borrar(){if(confirm("¿BORRAR TODO?")){db=[];localStorage.removeItem(KEY);render();}}
</script>
</body></html>
