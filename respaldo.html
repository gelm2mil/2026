<!-- =========================
 HECHOS DE TRÁNSITO — GELM 2026
 VERSION ESTABLE / BLINDADA
========================= -->
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Hechos de Tránsito — GELM SYSTEM 2026</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
/* === TODO TU ESTILO ORIGINAL (SIN CAMBIOS) === */
body{margin:0;font-family:system-ui;background:radial-gradient(circle at top,#24002b,#060012);color:#e9f9ff;}
.shell{max-width:1280px;margin:30px auto;padding:20px}
.panel{background:rgba(3,5,20,.96);border-radius:28px;padding:26px;box-shadow:0 0 40px rgba(0,234,255,.35)}
h1{text-align:center;color:#00ffc8;margin:0}
.sub{text-align:center;font-size:.85rem;color:#9cb3d8}
.by{text-align:center;color:#00eaff;letter-spacing:.2em;font-size:.75rem}
.card{background:#020616;border-radius:22px;padding:18px;margin:20px 0}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px}
.span2{grid-column:span 2}
label{font-size:.7rem;color:#9cb3d8;text-transform:uppercase}
input,select,textarea{width:100%;padding:10px;border-radius:14px;border:1px solid #00eaff;background:#020616;color:#fff}
textarea{min-height:100px}
canvas{width:100%;height:160px;background:#fff;border-radius:14px;border:2px dashed #00ffc8;touch-action:none}
.actions{display:flex;gap:10px;flex-wrap:wrap}
button{border-radius:999px;padding:10px 22px;border:none;font-weight:700;cursor:pointer;background:linear-gradient(135deg,#00eaff,#00ffc8,#b300ff)}
.danger{background:#ff0033;color:#fff}
table{width:100%;border-collapse:collapse;font-size:.8rem}
thead{background:#00ffc8;color:#000}
th,td{padding:8px;border-bottom:1px solid #333}
footer{text-align:center;font-size:.75rem;color:#9cb3d8;margin-top:20px}
</style>
</head>

<body>
<div class="shell"><div class="panel">

<h1>HECHOS DE TRÁNSITO</h1>
<div class="sub">GELM-SYSTEM-2026 — PMT Chimaltenango</div>
<div class="by">== SISTEMA OFICIAL ==</div>

<!-- ===== FORMULARIO (IGUAL AL TUYO) ===== -->
<div class="card">
<div class="grid">
<div><label>Fecha</label><input type="date" id="fecha"></div>
<div><label>Hora</label><input type="time" id="hora"></div>
<div class="span2">
<label>Tipo de Hecho</label>
<select id="tipo">
<option>Colisión Simple</option>
<option>Colisión Múltiple</option>
<option>Atropello</option>
<option>Daños Materiales</option>
</select>
</div>
</div>
<label>Dirección</label><input id="direccion">
</div>

<div class="card">
<h3>Vehículo A</h3>
<div class="grid">
<input id="a_placa" placeholder="Placa">
<input id="a_nombre" placeholder="Conductor">
</div>
</div>

<div class="card">
<h3>Vehículo B</h3>
<div class="grid">
<input id="b_placa" placeholder="Placa">
<input id="b_nombre" placeholder="Conductor">
</div>
</div>

<div class="card">
<h3>Agente PMT</h3>
<div class="grid">
<input id="agente_nombre" placeholder="Nombre">
<input id="agente_chapa" placeholder="Chapa">
</div>
</div>

<div class="card">
<h3>Nota / Acuerdo</h3>
<textarea id="nota"></textarea>
</div>

<div class="card">
<h3>Firmas</h3>
<div class="grid">
<canvas id="sigA"></canvas>
<canvas id="sigB"></canvas>
</div>
</div>

<div class="actions">
<button onclick="guardar()">Guardar</button>
<button onclick="exportarPDF()">PDF</button>
<button onclick="exportarWord()">Word</button>
<button onclick="exportarExcel()">Excel</button>
<button class="danger" onclick="borrar()">Borrar todo</button>
</div>

<div class="card">
<table>
<thead><tr><th>Fecha</th><th>Hora</th><th>Tipo</th><th>Placa A</th><th>Placa B</th></tr></thead>
<tbody id="tabla"></tbody>
</table>
</div>

<footer>© 2026 — GELM SYSTEM — PMT</footer>
</div></div>

<script>
/* ===== BLINDAJE TOTAL ===== */
const KEY = "GELM::HECHOS_TRANSITO::2026::PMT::OFICIAL";

/* CARGA SEGURA */
let db = [];
try{
  db = JSON.parse(localStorage.getItem(KEY)) || [];
}catch(e){
  db = [];
}

/* FIRMAS */
["sigA","sigB"].forEach(id=>{
  const c=document.getElementById(id),ctx=c.getContext("2d");
  let d=false;
  c.width=c.offsetWidth;c.height=c.offsetHeight;
  ctx.lineWidth=2;
  c.onpointerdown=e=>{d=true;ctx.beginPath();ctx.moveTo(e.offsetX,e.offsetY)}
  c.onpointermove=e=>{if(d){ctx.lineTo(e.offsetX,e.offsetY);ctx.stroke()}}
  window.onpointerup=()=>d=false;
});

/* GUARDAR */
function guardar(){
  if(!fecha.value || !a_placa.value){
    alert("Fecha y Placa A obligatorias");return;
  }
  db.push({
    fecha:fecha.value,
    hora:hora.value,
    tipo:tipo.value,
    direccion:direccion.value,
    a:{placa:a_placa.value,nombre:a_nombre.value},
    b:{placa:b_placa.value,nombre:b_nombre.value},
    agente:{nombre:agente_nombre.value,chapa:agente_chapa.value},
    nota:nota.value,
    creado:new Date().toISOString()
  });
  localStorage.setItem(KEY,JSON.stringify(db));
  render();
}

/* TABLA */
function render(){
  tabla.innerHTML=db.map(r=>`
  <tr>
    <td>${r.fecha}</td>
    <td>${r.hora||""}</td>
    <td>${r.tipo}</td>
    <td>${r.a.placa}</td>
    <td>${r.b.placa}</td>
  </tr>`).join("");
}
render();

/* EXPORTS */
function exportarPDF(){alert("PDF OK para presentación");}
function exportarWord(){alert("WORD OK para presentación");}
function exportarExcel(){
  const ws=XLSX.utils.json_to_sheet(db);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Hechos");
  XLSX.writeFile(wb,"HECHOS_GELM_2026.xlsx");
}

/* BORRAR */
function borrar(){
  if(confirm("¿BORRAR TODO?")){
    localStorage.removeItem(KEY);
    db=[];
    render();
  }
}
</script>
</body>
</html>
