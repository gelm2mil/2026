<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hechos de Tránsito — GELM 2026</title>

<!-- LIBRERÍAS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/docx@8.2.2/build/index.umd.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

<style>
body{background:#020510;color:#e9f9ff;font-family:system-ui;margin:0}
.panel{max-width:1000px;margin:20px auto;padding:25px;background:#05091f;border-radius:24px}
button{padding:10px 18px;border-radius:999px;border:none;font-weight:600;cursor:pointer}
.btn-save{background:#00ffc8}
.btn-pdf{background:#b300ff;color:#fff}
.btn-word{background:#0d6efd;color:#fff}
.btn-excel{background:#28a745;color:#fff}
.btn-del{background:#ff0033;color:#fff}

table{width:100%;border-collapse:collapse;margin-top:20px}
th{background:#00ffc8;color:#020510;padding:8px}
td{padding:8px;border-bottom:1px solid #333}
tr.sel{background:rgba(0,255,200,.25)}
</style>
</head>

<body>
<div class="panel">

<h2 style="text-align:center;color:#00ffc8">HECHOS DE TRÁNSITO — GELM 2026</h2>

<input id="fecha" type="date">
<input id="hora" type="time">
<input id="direccion" placeholder="Lugar">
<input id="a_placa" placeholder="Placa A">
<input id="b_placa" placeholder="Placa B">

<textarea id="nota" placeholder="Nota / acuerdo"></textarea>

<div>
<button class="btn-save" onclick="guardar()">Guardar</button>
<button class="btn-pdf" onclick="pdf()">PDF</button>
<button class="btn-word" onclick="word()">Word</button>
<button class="btn-excel" onclick="excel()">Excel</button>
<button class="btn-del" onclick="borrar()">Borrar Todo</button>
</div>

<table>
<thead>
<tr><th>Fecha</th><th>Hora</th><th>Lugar</th><th>Vehículos</th></tr>
</thead>
<tbody id="tabla"></tbody>
</table>

</div>

<script>
const KEY="hechos_gelm_2026";
let db=JSON.parse(localStorage.getItem(KEY)||"[]");
let selectedIndex=null;

function guardar(){
  const r={
    fecha:fecha.value,
    hora:hora.value,
    direccion:direccion.value,
    placaA:a_placa.value,
    placaB:b_placa.value,
    nota:nota.value
  };
  db.push(r);
  localStorage.setItem(KEY,JSON.stringify(db));
  render();
}

function render(){
  tabla.innerHTML="";
  db.forEach((r,i)=>{
    const tr=document.createElement("tr");
    if(i===selectedIndex) tr.classList.add("sel");
    tr.onclick=()=>{selectedIndex=i;render()};
    tr.innerHTML=`
      <td>${r.fecha}</td>
      <td>${r.hora}</td>
      <td>${r.direccion}</td>
      <td>${r.placaA} / ${r.placaB}</td>`;
    tabla.appendChild(tr);
  });
}
render();

function seleccionado(){
  if(selectedIndex===null){
    alert("Selecciona un registro abajo");
    return null;
  }
  return db[selectedIndex];
}

/* PDF */
function pdf(){
  const r=seleccionado(); if(!r) return;
  const {jsPDF}=window.jspdf;
  const d=new jsPDF();
  d.text("HECHOS DE TRÁNSITO — GELM 2026",105,15,{align:"center"});
  d.text(`Fecha: ${r.fecha} ${r.hora}`,20,30);
  d.text(`Lugar: ${r.direccion}`,20,40);
  d.text(`Vehículos: ${r.placaA} / ${r.placaB}`,20,50);
  d.text(d.splitTextToSize(r.nota,170),20,65);
  d.save("HECHOS_TRANSITO.pdf");
}

/* WORD REAL */
function word(){
  const r=seleccionado(); if(!r) return;
  const {Document,Packer,Paragraph,TextRun}=window.docx;
  const doc=new Document({
    sections:[{
      children:[
        new Paragraph({children:[new TextRun({text:"HECHOS DE TRÁNSITO — GELM 2026",bold:true})]}),
        new Paragraph(`Fecha: ${r.fecha} ${r.hora}`),
        new Paragraph(`Lugar: ${r.direccion}`),
        new Paragraph(`Vehículos: ${r.placaA} / ${r.placaB}`),
        new Paragraph(r.nota)
      ]
    }]
  });
  Packer.toBlob(doc).then(b=>saveAs(b,"HECHOS_TRANSITO.docx"));
}

/* EXCEL */
function excel(){
  const r=seleccionado(); if(!r) return;
  const ws=XLSX.utils.json_to_sheet([r]);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Hecho");
  XLSX.writeFile(wb,"HECHOS_TRANSITO.xlsx");
}

function borrar(){
  if(confirm("¿Borrar todo?")){
    db=[];selectedIndex=null;
    localStorage.removeItem(KEY);
    render();
  }
}
</script>

</body>
</html>
