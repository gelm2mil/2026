<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hechos de Tránsito — GELM 2026</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
:root{
  --c1:#00eaff;
  --c2:#00ffc8;
  --bg:#020510;
  --card:rgba(3,5,25,.96);
  --txt:#e9f9ff;
}
body{
  margin:0;
  font-family:Segoe UI,system-ui;
  background:radial-gradient(circle at 0 0,#28d7ff 0,#150027 45%,#050109 100%);
  color:var(--txt);
  display:flex;
  justify-content:center;
}
.panel{
  width:100%;
  max-width:1000px;
  margin:20px;
  padding:25px;
  background:var(--card);
  border-radius:28px;
  border:2px solid rgba(0,255,191,.35);
  box-shadow:0 0 40px rgba(0,255,191,.35);
}
h1{
  text-align:center;
  color:var(--c2);
  letter-spacing:.15em;
}
.section{
  margin-top:18px;
  border:1px solid rgba(0,255,191,.25);
  border-radius:18px;
  padding:15px;
}
label{
  font-size:.7rem;
  color:#9cb3d8;
  text-transform:uppercase;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:10px;
}
input,select,textarea{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid var(--c1);
  background:#000;
  color:#fff;
}
textarea{resize:vertical;}
canvas{
  background:#fff;
  border-radius:10px;
  width:100%;
  height:140px;
}
.actions{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:12px;
  margin-top:20px;
}
button{
  padding:14px;
  border-radius:999px;
  border:none;
  font-weight:bold;
  cursor:pointer;
}
.btn-save{background:linear-gradient(90deg,#00eaff,#00ffc8);color:#001;}
.btn-pdf{background:linear-gradient(90deg,#8f00ff,#ff0055);color:#fff;}
.btn-word{background:#0d6efd;color:#fff;}
.btn-excel{background:#28a745;color:#fff;}
.btn-del{background:#ff0033;color:#fff;}

table{
  width:100%;
  margin-top:20px;
  border-collapse:collapse;
  font-size:.8rem;
}
th{
  background:var(--c1);
  color:#001;
  padding:8px;
}
td{
  padding:8px;
  border-bottom:1px solid rgba(0,255,191,.2);
}
tr.sel{
  background:#00ffc844;
}
footer{
  margin-top:20px;
  text-align:center;
  font-size:10px;
  opacity:.6;
}
</style>
</head>

<body>
<div class="panel">
<h1>HECHOS DE TRÁNSITO — GELM 2026</h1>

<div class="section grid">
  <div><label>Fecha</label><input type="date" id="fecha"></div>
  <div><label>Hora</label><input type="time" id="hora"></div>
  <div>
    <label>Tipo de Hecho</label>
    <select id="tipo">
      <option>Colisión Simple</option>
      <option>Colisión Múltiple</option>
      <option>Atropello</option>
      <option>Daños Materiales</option>
    </select>
  </div>
</div>

<div class="section">
<label>Dirección / Lugar del Hecho</label>
<input id="direccion">
</div>

<div class="section">
<b>Vehículo A</b>
<div class="grid">
  <input id="a_placa" placeholder="Placa">
  <input id="a_tipo" placeholder="Tipo">
  <input id="a_marca" placeholder="Marca">
  <input id="a_color" placeholder="Color">
</div>
<b>Conductor A</b>
<div class="grid">
  <input id="a_nombre" placeholder="Nombre completo">
  <select id="a_tipo_lic">
    <option>Tipo Licencia</option>
    <option>Tipo A</option>
    <option>Tipo B</option>
    <option>Tipo C</option>
    <option>Tipo M</option>
    <option>No posee</option>
  </select>
  <input id="a_lic" placeholder="No. Licencia">
  <input id="a_doc" placeholder="No. Documento">
</div>
</div>

<div class="section">
<b>Vehículo B</b>
<div class="grid">
  <input id="b_placa" placeholder="Placa">
  <input id="b_tipo" placeholder="Tipo">
  <input id="b_marca" placeholder="Marca">
  <input id="b_color" placeholder="Color">
</div>
<b>Conductor B</b>
<div class="grid">
  <input id="b_nombre" placeholder="Nombre completo">
  <select id="b_tipo_lic">
    <option>Tipo Licencia</option>
    <option>Tipo A</option>
    <option>Tipo B</option>
    <option>Tipo C</option>
    <option>Tipo M</option>
    <option>No posee</option>
  </select>
  <input id="b_lic" placeholder="No. Licencia">
  <input id="b_doc" placeholder="No. Documento">
</div>
</div>

<div class="section">
<label>Nota / Acuerdo</label>
<textarea id="nota" rows="3"></textarea>
</div>

<div class="section">
<b>Firmas</b>
<div class="grid">
  <canvas id="sigA"></canvas>
  <canvas id="sigB"></canvas>
</div>
</div>

<div class="actions">
<button class="btn-save" onclick="guardar()">Guardar</button>
<button class="btn-pdf" onclick="pdf()">PDF</button>
<button class="btn-word" onclick="word()">Word</button>
<button class="btn-excel" onclick="excel()">Excel</button>
<button class="btn-del" onclick="borrar()">Borrar</button>
</div>

<table>
<thead><tr><th>Fecha</th><th>Tipo</th><th>Vehículos</th></tr></thead>
<tbody id="tabla"></tbody>
</table>

<footer>2026 — Sistema GELM — PMT Chimaltenango</footer>
</div>

<script>
const KEY="hechos_gelm_2026";
let db=JSON.parse(localStorage.getItem(KEY)||"[]");
let seleccionado=null;

/* firmas */
["sigA","sigB"].forEach(id=>{
  const c=document.getElementById(id),x=c.getContext("2d");
  c.width=c.offsetWidth;c.height=c.offsetHeight;
  let d=false;
  const p=e=>{
    const r=c.getBoundingClientRect();
    return{ x:(e.touches?e.touches[0].clientX:e.clientX)-r.left,
            y:(e.touches?e.touches[0].clientY:e.clientY)-r.top };
  };
  c.onmousedown=e=>{d=true;x.beginPath();const q=p(e);x.moveTo(q.x,q.y);}
  c.onmousemove=e=>{if(!d)return;const q=p(e);x.lineTo(q.x,q.y);x.stroke();}
  window.onmouseup=()=>d=false;
  c.ontouchstart=e=>{d=true;x.beginPath();const q=p(e);x.moveTo(q.x,q.y);}
  c.ontouchmove=e=>{e.preventDefault();if(!d)return;const q=p(e);x.lineTo(q.x,q.y);x.stroke();}
});

function guardar(){
  const r={
    fecha:fecha.value,hora:hora.value,tipo:tipo.value,direccion:direccion.value,
    a:{placa:a_placa.value,marca:a_marca.value,color:a_color.value,nombre:a_nombre.value,tipoLic:a_tipo_lic.value,lic:a_lic.value},
    b:{placa:b_placa.value,marca:b_marca.value,color:b_color.value,nombre:b_nombre.value,tipoLic:b_tipo_lic.value,lic:b_lic.value},
    nota:nota.value,
    sigA:sigA.toDataURL(),sigB:sigB.toDataURL()
  };
  if(!r.fecha||!r.a.placa) return alert("Fecha y placa A obligatorias");
  db.push(r);localStorage.setItem(KEY,JSON.stringify(db));
  seleccionado=db.length-1;render();
}

function render(){
  tabla.innerHTML=db.map((x,i)=>`
    <tr onclick="sel(${i})" class="${i===seleccionado?'sel':''}">
      <td>${x.fecha}</td><td>${x.tipo}</td>
      <td>${x.a.placa} / ${x.b.placa}</td>
    </tr>`).join("");
}
function sel(i){seleccionado=i;render();}
render();

function actual(){return seleccionado!==null?db[seleccionado]:db.at(-1);}

function pdf(){
  const r=actual(); if(!r) return;
  const {jsPDF}=window.jspdf; const d=new jsPDF();
  d.text("HECHOS DE TRÁNSITO — GELM 2026",105,15,{align:"center"});
  d.text(`Fecha: ${r.fecha} ${r.hora}`,20,30);
  d.text(`Lugar: ${r.direccion}`,20,36);
  d.text(`Vehículo A: ${r.a.placa}`,20,46);
  d.text(`Conductor A: ${r.a.nombre}`,20,52);
  d.text(`Vehículo B: ${r.b.placa}`,20,62);
  d.text(`Conductor B: ${r.b.nombre}`,20,68);
  d.text(d.splitTextToSize(r.nota,170),20,82);
  d.addImage(r.sigA,"PNG",20,120,70,30);
  d.addImage(r.sigB,"PNG",120,120,70,30);
  d.save("HECHOS_GELM_2026.pdf");
}

function word(){
  const r=actual(); if(!r) return;
  const t=`HECHOS DE TRÁNSITO — GELM 2026

Fecha: ${r.fecha} ${r.hora}
Lugar: ${r.direccion}

Vehículo A: ${r.a.placa}
Conductor A: ${r.a.nombre}

Vehículo B: ${r.b.placa}
Conductor B: ${r.b.nombre}

Nota:
${r.nota}

Sistema GELM 2026 — PMT Chimaltenango`;
  const b=new Blob([t],{type:"application/msword;charset=utf-8"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);a.download="HECHOS_GELM_2026.doc";a.click();
}

function excel(){
  const data=seleccionado!==null?[db[seleccionado]]:db;
  const ws=XLSX.utils.json_to_sheet(data);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Hechos");
  XLSX.writeFile(wb,"HECHOS_GELM_2026.xlsx");
}

function borrar(){
  if(confirm("¿BORRAR TODO?")){
    db=[];seleccionado=null;
    localStorage.removeItem(KEY);render();
  }
}
</script>
</body>
</html>
