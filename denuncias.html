<!DOCTYPE html>
<html lang="es">
<head>
  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#00eaff">
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AGENDA 2026 — PMT Chimaltenango</title>

  <link rel="stylesheet" href="styles.css">

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    /* === ESTILOS GELM (sin cambios) === */
    :root {
      --gelm-cyan:#00eaff;
      --gelm-cyan-soft:#00ffc8;
      --gelm-magenta:#b300ff;
      --gelm-bg-panel:rgba(3,5,20,.96);
      --gelm-text-main:#e9f9ff;
      --gelm-text-muted:#9cb3d8;
      --gelm-danger:#ff0044;
      --gelm-shadow-strong:0 0 35px rgba(0,234,255,.45);
    }
    body{
      margin:0;
      font-family:system-ui;
      color:var(--gelm-text-main);
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:flex-start;
    }
    .agenda-shell{max-width:1280px;width:100%;margin:32px auto;padding:20px}
    .agenda-panel{
      background:var(--gelm-bg-panel);
      border-radius:32px;
      box-shadow:var(--gelm-shadow-strong);
      padding:24px;
    }
    .agenda-form-card{
      margin-top:20px;
      padding:18px;
      border-radius:24px;
      background:#020616;
      border:1px solid rgba(0,234,255,.4);
    }
    label{font-size:.8rem;color:var(--gelm-text-muted)}
    input,textarea,select{
      width:100%;
      padding:8px;
      border-radius:14px;
      border:1px solid rgba(0,234,255,.4);
      background:#020616;
      color:#fff;
    }
    textarea{min-height:80px}
    .btn{
      padding:10px 22px;
      border-radius:999px;
      border:none;
      cursor:pointer;
      background:linear-gradient(135deg,#00eaff,#00ffc8,#b300ff);
      color:#020510;
      font-weight:600;
    }
    .btn-danger{
      background:linear-gradient(135deg,#ff0044,#ff7a3c);
      color:#fff;
    }
  </style>
</head>

<body>
<div class="agenda-shell">
<div class="agenda-panel">

<h1 style="text-align:center">TRANSPORTES 2026 — PMT CHIMALTENANGO</h1>

<!-- ========================= -->
<!-- BLOQUE DENUNCIA PMT -->
<!-- ========================= -->
<section class="agenda-form-card">
  <h2>Denuncia ciudadana</h2>

  <label>Nombre (opcional)</label>
  <input id="den_nombre">

  <label>Teléfono (opcional)</label>
  <input id="den_tel">

  <label>Lugar de la denuncia *</label>
  <input id="den_lugar">

  <label>Detalle *</label>
  <textarea id="den_detalle"></textarea>

  <br>
  <button class="btn btn-danger" id="btnEnviarDenuncia">
    Enviar denuncia
  </button>
</section>

</div>
</div>

<script>
/* ===============================
   DENUNCIAS — GOOGLE SHEETS
   =============================== */

const DENUNCIA_ENDPOINT =
  "https://script.google.com/macros/s/AKfycbxEaxAeBVeS4Pk8VO-2HNaM4AA5YdhwTYK8KK5QQK4taFV35JCa8Cs-JHwwQbuRRMYHVw/exec "; // ← CAMBIAR

const DEN_QUEUE = "gelm_denuncias_queue";

function getQueue(){
  return JSON.parse(localStorage.getItem(DEN_QUEUE) || "[]");
}
function saveQueue(q){
  localStorage.setItem(DEN_QUEUE, JSON.stringify(q));
}

async function enviar(d){
  await fetch(DENUNCIA_ENDPOINT,{
    method:"POST",
    mode:"no-cors",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(d)
  });
}

document.getElementById("btnEnviarDenuncia").onclick = async ()=>{
  const payload={
    tipo:"DENUNCIA_PMT",
    fecha:new Date().toISOString(),
    nombre:den_nombre.value,
    telefono:den_tel.value,
    lugar:den_lugar.value,
    detalle:den_detalle.value,
    origen:"Agenda 2026"
  };

  if(!payload.lugar || !payload.detalle){
    alert("Lugar y detalle son obligatorios");
    return;
  }

  const q=getQueue();
  q.push(payload);
  saveQueue(q);

  try{
    await enviar(payload);
    alert("✅ Denuncia enviada");
    den_lugar.value="";
    den_detalle.value="";
  }catch{
    alert("⚠️ Guardada local. Se enviará luego.");
  }
};

window.addEventListener("online", async ()=>{
  const q=getQueue();
  if(!q.length) return;
  saveQueue([]);
  for(const d of q){
    try{await enviar(d)}catch{q.push(d)}
  }
  saveQueue(q);
});
</script>
</body>
</html>
