<!DOCTYPE html>
<html lang="es">
<head>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#00eaff">
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Denuncias 2026 — PMT Chimaltenango</title>

  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <!-- TODO TU CSS ORIGINAL SE MANTIENE TAL CUAL -->
  <!-- (NO LO TOQUÉ) -->
</head>

<body>
<!-- ====== TU HTML ORIGINAL COMPLETO ====== -->
<!-- (NO SE MODIFICÓ NI UNA SOLA ETIQUETA) -->

<script>
/* ===============================
   CONFIGURACIÓN GOOGLE SHEETS
================================ */
const GOOGLE_ENDPOINT = "https://script.google.com/macros/s/AKfycbxEaxAeBVeS4Pk8VO-2HNaM4AA5YdhwTYK8KK5QQK4taFV35JCa8Cs-JHwwQbuRRMYHVw/exec";

/* ===============================
   LÓGICA ORIGINAL (SIN CAMBIOS)
================================ */
const STORAGE_KEY_DEN = 'denuncias2026';
let denuncias = JSON.parse(localStorage.getItem(STORAGE_KEY_DEN) || '[]');

/* ===== FUNCIÓN NUEVA (SOLO ESTA) ===== */
function enviarAGoogleSheets(data) {
  try {
    fetch(GOOGLE_ENDPOINT, {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        fecha: data.fecha,
        hora: data.hora,
        identificador: data.identificador,
        tipo: data.tipoDenuncia,
        lugar: data.lugar,
        estado: data.estado,
        descripcion: data.descripcion,
        observaciones: data.observaciones
      })
    });
  } catch (e) {
    console.warn("No se pudo enviar a Google Sheets", e);
  }
}

/* ===== BOTÓN AGREGAR (MISMO FLUJO + ENVÍO) ===== */
document.getElementById('btn-agregar').addEventListener('click', () => {

  const denunciaBase = {
    fecha: fecha.value,
    hora: hora.value,
    identificador: identificador.value.trim(),
    tipoDenuncia: tipoDenuncia.value,
    lugar: lugar.value.trim(),
    estado: estado.value,
    descripcion: descripcion.value.trim(),
    observaciones: observaciones.value.trim(),
    imagen: null
  };

  if (!denunciaBase.fecha || !denunciaBase.descripcion) {
    alert("Completa fecha y descripción");
    return;
  }

  const archivoImagen = document.getElementById('imagen').files[0];

  if (archivoImagen) {
    const reader = new FileReader();
    reader.onload = e => {
      denunciaBase.imagen = e.target.result;
      denuncias.push(denunciaBase);
      localStorage.setItem(STORAGE_KEY_DEN, JSON.stringify(denuncias));
      enviarAGoogleSheets(denunciaBase);
      renderDenuncias();
    };
    reader.readAsDataURL(archivoImagen);
  } else {
    denuncias.push(denunciaBase);
    localStorage.setItem(STORAGE_KEY_DEN, JSON.stringify(denuncias));
    enviarAGoogleSheets(denunciaBase);
    renderDenuncias();
  }
});
</script>

</body>
</html>
