<!DOCTYPE html>
<html lang="es">
<head>
  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#00eaff">
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Denuncias 2026 — PMT Chimaltenango</title>

  <link rel="stylesheet" href="styles.css">

  <!-- (todo tu CSS queda IGUAL, no lo repito aquí por espacio) -->
  <!-- ⚠️ NO se modificó nada del style -->

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>

<!-- (todo tu HTML visual queda IGUAL, no se tocó nada) -->

<script>
  /* ===============================
     CONFIGURACIÓN
     =============================== */
  const STORAGE_KEY_DEN = 'denuncias2026';
  const GOOGLE_SCRIPT_URL =
    "https://script.google.com/macros/s/AKfycbxEaxAeBVeS4Pk8VO-2HNaM4AA5YdhwTYK8KK5QQK4taFV35JCa8Cs-JHwwQbuRRMYHVw/exec";

  let denuncias = JSON.parse(localStorage.getItem(STORAGE_KEY_DEN) || '[]');

  /* ===============================
     ENVÍO A GOOGLE SHEETS
     =============================== */
  function enviarAGoogle(denuncia) {
    fetch(GOOGLE_SCRIPT_URL, {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        fecha: denuncia.fecha || "",
        hora: denuncia.hora || "",
        identificador: denuncia.identificador || "",
        tipo: denuncia.tipoDenuncia || "",
        lugar: denuncia.lugar || "",
        estado: denuncia.estado || "",
        descripcion: denuncia.descripcion || "",
        observaciones: denuncia.observaciones || "",
        imagen: denuncia.imagen ? "SI" : "NO",
        sistema: "DENUNCIAS 2026 PMT CHIMALTENANGO",
        timestamp: new Date().toISOString()
      })
    }).catch(() => {
      console.warn("No se pudo enviar a Google Sheets");
    });
  }

  /* ===============================
     TU LÓGICA EXISTENTE
     =============================== */

  function guardarDenuncias() {
    localStorage.setItem(STORAGE_KEY_DEN, JSON.stringify(denuncias));
    document.getElementById('ultima-actualizacion').textContent =
      new Date().toLocaleString('es-GT');
  }

  document.getElementById('btn-agregar').addEventListener('click', () => {
    const fecha = document.getElementById('fecha').value;
    const hora = document.getElementById('hora').value;
    const identificador = document.getElementById('identificador').value.trim();
    const tipoDenuncia = document.getElementById('tipoDenuncia').value;
    const lugar = document.getElementById('lugar').value.trim();
    const estado = document.getElementById('estado').value;
    const descripcion = document.getElementById('descripcion').value.trim();
    const observaciones = document.getElementById('observaciones').value.trim();
    const archivoImagen = document.getElementById('imagen').files[0];

    if (!fecha || !descripcion) {
      alert("Completa los campos obligatorios");
      return;
    }

    const denunciaBase = {
      fecha,
      hora,
      identificador,
      tipoDenuncia,
      lugar,
      estado,
      descripcion,
      observaciones,
      imagen: null
    };

    if (archivoImagen) {
      const reader = new FileReader();
      reader.onload = e => {
        denunciaBase.imagen = e.target.result;
        denuncias.push(denunciaBase);
        guardarDenuncias();
        enviarAGoogle(denunciaBase);
        location.reload();
      };
      reader.readAsDataURL(archivoImagen);
    } else {
      denuncias.push(denunciaBase);
      guardarDenuncias();
      enviarAGoogle(denunciaBase);
      location.reload();
    }
  });
</script>

</body>
</html>
