<!DOCTYPE html>
<html lang="es">
<head>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#00eaff">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AGENDA 2026 — PMT Chimaltenango</title>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    :root {
      --gelm-cyan: #00eaff;
      --gelm-cyan-soft: #00ffc8;
      --gelm-magenta: #b300ff;
      --gelm-bg-panel: rgba(3, 5, 20, 0.96);
      --gelm-text-main: #e9f9ff;
      --gelm-text-muted: #9cb3d8;
      --gelm-danger: #ff0044;
      --gelm-radius-xl: 24px;
    }

    body {
      margin: 0; padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: var(--gelm-text-main);
      background: #020510;
      min-height: 100vh;
    }

    /* Estilos de la Agenda */
    .agenda-shell { width: 100%; max-width: 1280px; margin: 20px auto; padding: 10px; }
    .agenda-panel {
      background: var(--gelm-bg-panel);
      border-radius: 32px;
      border: 1px solid rgba(0, 234, 255, 0.3);
      padding: 24px;
      box-shadow: 0 0 40px rgba(0, 234, 255, 0.2);
    }

    header { display: flex; justify-content: space-between; align-items: center; text-align: center; margin-bottom: 20px; }
    .logo-box img { width: 70px; filter: drop-shadow(0 0 10px var(--gelm-cyan)); }
    
    nav { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    .nav-pill { 
      padding: 8px 20px; border-radius: 20px; border: 1px solid var(--gelm-cyan);
      background: transparent; color: white; cursor: pointer; text-decoration: none;
    }
    .active { background: var(--gelm-cyan); color: black; font-weight: bold; }

    /* Formulario */
    .agenda-form-card { 
      background: rgba(255,255,255,0.03); padding: 20px; border-radius: var(--gelm-radius-xl);
      border: 1px solid rgba(0, 234, 255, 0.1); margin-bottom: 20px;
    }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
    label { display: block; font-size: 0.8rem; color: var(--gelm-cyan); margin-bottom: 5px; text-transform: uppercase; }
    input, select, textarea { 
      width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #333; 
      background: #000; color: white; box-sizing: border-box;
    }
    .full-width { grid-column: 1 / -1; }

    /* Botones */
    .btn { 
      padding: 12px 25px; border-radius: 30px; border: none; cursor: pointer; 
      font-weight: bold; text-transform: uppercase; transition: 0.3s;
    }
    .btn-add { background: var(--gelm-cyan); color: black; }
    .btn-excel { background: #217346; color: white; }
    .btn-pdf { background: var(--gelm-magenta); color: white; }
    .btn-danger { background: var(--gelm-danger); color: white; }

    /* Tabla */
    .table-wrapper { overflow-x: auto; background: rgba(0,0,0,0.3); border-radius: 15px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th { background: var(--gelm-cyan); color: black; padding: 12px; text-align: left; }
    td { padding: 12px; border-bottom: 1px solid #222; vertical-align: top; }
    .img-mini { width: 60px; height: 60px; object-fit: cover; border-radius: 5px; cursor: pointer; border: 1px solid var(--gelm-cyan); }

    /* MODO IMPRESIÓN (PDF PROFESIONAL) */
    @media print {
      body { background: white !important; color: black !important; }
      .agenda-form-card, nav, .btn, #filtroMes, .no-print { display: none !important; }
      .agenda-panel { border: none !important; box-shadow: none !important; width: 100% !important; }
      th { background: #f0f0f0 !important; color: black !important; border: 1px solid #000 !important; }
      td { border: 1px solid #ccc !important; color: black !important; font-size: 10pt; }
      .img-mini { width: 120px !important; height: auto !important; }
      .agenda-shell { max-width: 100% !important; margin: 0 !important; }
    }
  </style>
</head>

<body>
<div class="agenda-shell">
  <div class="agenda-panel">
    
    <header>
      <div class="logo-box"><img src="icons/icon-192.png" alt="logo"></div>
      <div>
        <h1 style="color:var(--gelm-cyan); margin:0;">TRANSPORTES 2026</h1>
        <small>UNIDAD DE TRANSPORTES — BY GELM</small>
      </div>
      <div class="logo-box"><img src="icons/icon-192.png" alt="logo"></div>
    </header>

    <nav class="no-print">
      <a href="#" class="nav-pill active">Agenda 2026</a>
      <button class="nav-pill">Operativos</button>
      <button class="nav-pill">Denuncias</button>
    </nav>

    <section class="agenda-form-card no-print">
      <div class="grid">
        <div>
          <label>Fecha</label>
          <input type="date" id="fecha">
        </div>
        <div>
          <label>Categoría</label>
          <select id="categoria">
            <option value="Operativo">Operativo</option>
            <option value="Supervisión">Supervisión</option>
            <option value="Administrativo">Administrativo</option>
          </select>
        </div>
        <div>
          <label>Lugar / Ruta</label>
          <input type="text" id="lugar" placeholder="Ubicación">
        </div>
        <div class="full-width">
          <label>Detalle de Actividad (Se ajusta en PDF)</label>
          <textarea id="detalle" rows="3" placeholder="Escriba aquí todo el reporte..."></textarea>
        </div>
        <div class="full-width">
          <label>Evidencia Fotográfica</label>
          <input type="file" id="foto" accept="image/*" capture="environment">
          <div id="previewContainer" style="margin-top:10px; display:none;">
            <img id="imgPreview" src="" style="width:100px; border-radius:10px;">
          </div>
        </div>
      </div>

      <div style="margin-top:20px; display:flex; gap:10px; flex-wrap:wrap;">
        <button class="btn btn-add" id="btnAgregar">Guardar Actividad</button>
        <select id="filtroMes" style="width:auto; background:#111; color:var(--gelm-cyan);">
          <option value="0">Ver Todo el Año</option>
          <option value="1">Enero</option><option value="2">Febrero</option>
          <option value="3">Marzo</option><option value="4">Abril</option>
          <option value="5">Mayo</option><option value="6">Junio</option>
          <option value="7">Julio</option><option value="8">Agosto</option>
          <option value="9">Septiembre</option><option value="10">Octubre</option>
          <option value="11">Noviembre</option><option value="12">Diciembre</option>
        </select>
        <button class="btn btn-excel" onclick="exportarExcel()">Descargar Excel</button>
        <button class="btn btn-pdf" onclick="window.print()">Generar PDF</button>
        <button class="btn btn-danger" onclick="borrarTodo()">Borrar Todo</button>
      </div>
    </section>

    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Categoría</th>
            <th>Lugar</th>
            <th>Detalle Técnico</th>
            <th>Foto</th>
          </tr>
        </thead>
        <tbody id="tbodyAgenda"></tbody>
      </table>
    </div>

    <footer style="text-align:center; margin-top:20px; font-size:0.8rem; color:var(--gelm-text-muted);">
      <p>SISTEMA DE CONTROL DE TRANSPORTES 2026 | <strong>UNIDAD GELM</strong></p>
    </footer>
  </div>
</div>

<script>
  const STORAGE_KEY = "agenda_2026_gelm";
  let actividades = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
  let fotoBase64 = "";

  // Captura de Foto y Previsualización
  document.getElementById("foto").addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(event) {
        fotoBase64 = event.target.result;
        document.getElementById("imgPreview").src = fotoBase64;
        document.getElementById("previewContainer").style.display = "block";
      };
      reader.readAsDataURL(file);
    }
  });

  function guardarYRender() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(actividades));
    renderTabla();
  }

  function renderTabla() {
    const tbody = document.getElementById("tbodyAgenda");
    const mes = parseInt(document.getElementById("filtroMes").value);
    tbody.innerHTML = "";

    const filtradas = actividades.filter(a => {
      if (mes === 0) return true;
      return new Date(a.fecha).getMonth() + 1 === mes;
    }).sort((a,b) => new Date(a.fecha) - new Date(b.fecha));

    filtradas.forEach((act, index) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${act.fecha.split('-').reverse().join('/')}</td>
        <td><b>${act.categoria}</b></td>
        <td>${act.lugar}</td>
        <td style="white-space: pre-wrap;">${act.detalle}</td>
        <td>${act.foto ? `<img src="${act.foto}" class="img-mini" onclick="window.open('${act.foto}')">` : 'N/A'}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  document.getElementById("btnAgregar").onclick = () => {
    const fecha = document.getElementById("fecha").value;
    const categoria = document.getElementById("categoria").value;
    const lugar = document.getElementById("lugar").value;
    const detalle = document.getElementById("detalle").value;

    if(!fecha || !detalle) return alert("Complete fecha y detalle");

    actividades.push({ fecha, categoria, lugar, detalle, foto: fotoBase64 });
    fotoBase64 = "";
    document.getElementById("imgPreview").src = "";
    document.getElementById("previewContainer").style.display = "none";
    document.getElementById("detalle").value = "";
    guardarYRender();
  };

  function exportarExcel() {
    const mes = document.getElementById("filtroMes").value;
    const filtradas = actividades.filter(a => mes == 0 || new Date(a.fecha).getMonth() + 1 == mes);
    
    const data = filtradas.map(a => ({
      Fecha: a.fecha,
      Categoría: a.categoria,
      Lugar: a.lugar,
      Detalle: a.detalle,
      Evidencia: a.foto ? "CON FOTO" : "SIN FOTO"
    }));

    const ws = XLSX.utils.json_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Agenda");
    XLSX.writeFile(wb, `Agenda_GELM_Mes_${mes}.xlsx`);
  }

  function borrarTodo() {
    if(confirm("¿Borrar todos los registros de 2026?")) {
      actividades = [];
      guardarYRender();
    }
  }

  document.getElementById("filtroMes").onchange = renderTabla;
  renderTabla();
</script>
</body>
</html>
