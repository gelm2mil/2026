<!DOCTYPE html>
<html lang="es">
<head>
  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#00eaff">
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AGENDA 2026 — PMT Chimaltenango</title>

  <!-- ESTILO GLOBAL -->
  <link rel="stylesheet" href="styles.css">

  <!-- EXCEL -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>

<body>
<div class="agenda-shell">
  <div class="agenda-panel">

    <!-- HEADER -->
    <header class="agenda-header">
      <div class="agenda-logo-box">
        <img src="icons/icon-192.png">
      </div>

      <div class="agenda-title-block">
        <h1 class="agenda-title">AGENDA OPERATIVA 2026</h1>
        <p class="agenda-subtitle">
          Unidad de Transportes — PMT Chimaltenango
        </p>
        <div class="agenda-by">== BY GELM ==</div>
      </div>

      <div class="agenda-logo-box">
        <img src="icons/icon-192.png">
      </div>
    </header>

    <!-- RESUMEN -->
    <section class="agenda-summary">
      <div>
        Mostrando <strong id="resumenVisible">0</strong> de
        <strong id="resumenTotal">0</strong> registros —
        <strong id="resumenMes">Todos</strong>
      </div>
      <div id="ultimaActualizacion"></div>
    </section>

    <!-- FORMULARIO -->
    <section class="agenda-form-card">
      <h2 class="agenda-form-title">Registrar actividad</h2>

      <div class="agenda-form-grid">

        <div class="field-2">
          <label>Fecha</label>
          <input type="date" id="fecha">
        </div>

        <div class="field-2">
          <label>Categoría</label>
          <select id="categoria">
            <option value="Operativo">Operativo</option>
            <option value="Supervisión">Supervisión</option>
            <option value="Revisión">Revisión</option>
            <option value="Capacitación">Capacitación</option>
            <option value="Administrativo">Administrativo</option>
            <option value="Reunión">Reunión</option>
            <option value="Descanso">Descanso</option>
            <option value="Sancionando">Sancionando</option>
          </select>
        </div>

        <div>
          <label>Servicio</label>
          <select id="servicio">
            <option value="">(Opcional)</option>
            <option value="PMT">PMT</option>
            <option value="Apoyo">Apoyo</option>
            <option value="Extraordinario">Extraordinario</option>
          </select>
        </div>

        <div class="field-3">
          <label>Lugar / ruta</label>
          <input type="text" id="lugar" placeholder="Casco urbano, ruta, colonia…">
        </div>

        <div class="field-full">
          <label>Detalle</label>
          <textarea id="detalle"></textarea>
        </div>

      </div>

      <div class="agenda-actions-row">
        <button class="btn" id="btnAgregar">Agregar a la agenda</button>

        <div class="select-inline">
          <label>Ver mes</label>
          <select id="filtroMes">
            <option value="0">Todos</option>
            <option value="1">Enero</option>
            <option value="2">Febrero</option>
            <option value="3">Marzo</option>
            <option value="4">Abril</option>
            <option value="5">Mayo</option>
            <option value="6">Junio</option>
            <option value="7">Julio</option>
            <option value="8">Agosto</option>
            <option value="9">Septiembre</option>
            <option value="10">Octubre</option>
            <option value="11">Noviembre</option>
            <option value="12">Diciembre</option>
          </select>
        </div>

        <button class="btn btn-soft" id="btnExcel">Descargar Excel</button>
        <button class="btn btn-danger" id="btnBorrar">Borrar todo</button>
      </div>
    </section>

    <!-- TABLA -->
    <section class="agenda-table-card">
      <div class="agenda-table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Categoría</th>
              <th>Servicio</th>
              <th>Lugar</th>
              <th>Detalle</th>
            </tr>
          </thead>
          <tbody id="tbodyAgenda"></tbody>
        </table>

        <div class="agenda-empty" id="estadoVacio">
          No hay registros aún.
        </div>
      </div>
    </section>

    <!-- FOOTER -->
    <footer class="agenda-footer">
      2026 | <strong>BY GELM</strong><br>
      <span id="fechaActual"></span>
    </footer>

  </div>
</div>

<script>
/* =========================
   AGENDA 2026 — MOTOR DIOS
   ========================= */

const KEY = "agenda_2026_gelm";

const fecha = document.getElementById("fecha");
const categoria = document.getElementById("categoria");
const servicio = document.getElementById("servicio");
const lugar = document.getElementById("lugar");
const detalle = document.getElementById("detalle");

const filtroMes = document.getElementById("filtroMes");
const tbody = document.getElementById("tbodyAgenda");
const vacio = document.getElementById("estadoVacio");

const rVis = document.getElementById("resumenVisible");
const rTot = document.getElementById("resumenTotal");
const rMes = document.getElementById("resumenMes");
const ultima = document.getElementById("ultimaActualizacion");
const fechaActual = document.getElementById("fechaActual");

let datos = [];

/* UTIL */
const hoy = () => new Date().toISOString().split("T")[0];
const fmt = f => f.split("-").reverse().join("/");

/* STORAGE */
function cargar() {
  datos = JSON.parse(localStorage.getItem(KEY)) || [];
}
function guardar() {
  localStorage.setItem(KEY, JSON.stringify(datos));
  ultima.textContent = "Última actualización: " + new Date().toLocaleString("es-GT");
}

/* RENDER */
function render() {
  tbody.innerHTML = "";
  const mes = parseInt(filtroMes.value);

  const lista = datos.filter(d =>
    mes === 0 || parseInt(d.fecha.split("-")[1]) === mes
  );

  rTot.textContent = datos.length;
  rVis.textContent = lista.length;
  rMes.textContent = filtroMes.options[filtroMes.selectedIndex].text;

  vacio.style.display = lista.length ? "none" : "block";

  lista.forEach(d => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${fmt(d.fecha)}</td>
      <td>${d.categoria}</td>
      <td>${d.servicio || "-"}</td>
      <td>${d.lugar || "-"}</td>
      <td>${d.detalle}</td>`;
    tbody.appendChild(tr);
  });
}

/* ACCIONES */
document.getElementById("btnAgregar").onclick = () => {
  if (!detalle.value) return alert("Ingresa un detalle");

  datos.push({
    fecha: fecha.value,
    categoria: categoria.value,
    servicio: servicio.value,
    lugar: lugar.value,
    detalle: detalle.value
  });

  detalle.value = "";
  guardar();
  render();
};

document.getElementById("btnBorrar").onclick = () => {
  if (confirm("¿Borrar toda la agenda 2026?")) {
    datos = [];
    guardar();
    render();
  }
};

document.getElementById("btnExcel").onclick = () => {
  if (!datos.length) return alert("No hay datos");
  const ws = XLSX.utils.json_to_sheet(datos.map(d => ({
    Fecha: fmt(d.fecha),
    Categoría: d.categoria,
    Servicio: d.servicio,
    Lugar: d.lugar,
    Detalle: d.detalle
  })));
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Agenda 2026");
  XLSX.writeFile(wb, "Agenda_2026_GELM.xlsx");
};

filtroMes.onchange = render;

/* INIT */
fecha.value = hoy();
fechaActual.textContent =
  "Fecha actual: " +
  new Date().toLocaleDateString("es-GT",
    { day:"2-digit", month:"long", year:"numeric" });

cargar();
render();
</script>
</body>
</html>
