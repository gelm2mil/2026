<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Agenda Operativa</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
}
h1 {
  text-align: center;
}
label {
  display: block;
  margin-top: 10px;
}
input, select, textarea, button {
  width: 100%;
  padding: 6px;
  margin-top: 4px;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}
th, td {
  border: 1px solid #ccc;
  padding: 6px;
  text-align: left;
}
th {
  background: #eee;
}
.footer-fecha {
  margin-top: 20px;
  font-size: 12px;
  text-align: center;
  color: #555;
}
</style>
</head>

<body>

<h1>Agenda Operativa</h1>

<label>Fecha:
<input type="date" id="fecha">
</label>

<label>Categoría:
<select id="categoria">
  <option value="">Seleccione</option>
  <option value="Servicio">Servicio</option>
  <option value="Apoyo">Apoyo</option>
  <option value="Descanso">Descanso</option>
  <option value="Operativo">Operativo</option>
  <option value="Sancionando">Sancionando</option>
</select>
</label>

<label>Servicio:
<select id="servicio">
  <option value="">Seleccione</option>
  <option value="PMT">PMT</option>
  <option value="Administrativo">Administrativo</option>
</select>
</label>

<label>Lugar:
<input type="text" id="lugar">
</label>

<label>Detalle:
<textarea id="detalle"></textarea>
</label>

<button onclick="agregarActividad()">Agregar a la agenda</button>

<table>
<thead>
<tr>
  <th>Fecha</th>
  <th>Categoría</th>
  <th>Servicio</th>
  <th>Lugar</th>
  <th>Detalle</th>
</tr>
</thead>
<tbody id="tabla"></tbody>
</table>

<div class="footer-fecha" id="footerFecha"></div>

<script>
let actividades = [];

const fechaInput = document.getElementById("fecha");
const categoriaSel = document.getElementById("categoria");
const servicioSel = document.getElementById("servicio");
const lugarInput = document.getElementById("lugar");
const detalleTxt = document.getElementById("detalle");
const tabla = document.getElementById("tabla");

/* ===== FECHA AUTOMÁTICA ===== */
function setFechaHoy() {
  const hoy = new Date();
  const yyyy = hoy.getFullYear();
  const mm = String(hoy.getMonth() + 1).padStart(2, "0");
  const dd = String(hoy.getDate()).padStart(2, "0");
  fechaInput.value = `${yyyy}-${mm}-${dd}`;
}

/* ===== FOOTER ===== */
function setFechaActualFooter() {
  const f = new Date();
  document.getElementById("footerFecha").textContent =
    "Registro generado el " + f.toLocaleString("es-GT");
}

/* ===== STORAGE ===== */
function guardarEnStorage() {
  localStorage.setItem("agenda", JSON.stringify(actividades));
}

function cargarDesdeStorage() {
  const data = localStorage.getItem("agenda");
  if (data) {
    actividades = JSON.parse(data);
  }
}

/* ===== AGREGAR ===== */
function agregarActividad() {
  if (!fechaInput.value || !categoriaSel.value) {
    alert("Complete al menos fecha y categoría");
    return;
  }

  const ahora = new Date();

  const actividad = {
    fecha: fechaInput.value,
    horaRegistro: ahora.toLocaleTimeString("es-GT"),
    timestamp: ahora.toISOString(),
    categoria: categoriaSel.value,
    servicio: servicioSel.value,
    lugar: lugarInput.value.trim(),
    detalle: detalleTxt.value.trim()
  };

  actividades.push(actividad);
  guardarEnStorage();
  renderTabla();

  lugarInput.value = "";
  detalleTxt.value = "";
}

/* ===== TABLA ===== */
function renderTabla() {
  tabla.innerHTML = "";
  actividades.forEach(a => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${a.fecha}</td>
      <td>${a.categoria}</td>
      <td>${a.servicio}</td>
      <td>${a.lugar}</td>
      <td>${a.detalle}</td>
    `;
    tabla.appendChild(tr);
  });
}

/* ===== INICIO ===== */
cargarDesdeStorage();
setFechaHoy();
renderTabla();
setFechaActualFooter();
</script>

</body>
</html>
