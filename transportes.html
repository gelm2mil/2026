<!DOCTYPE html>
<html lang="es">
<head>
  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#00eaff">
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Operativos 2026 — PMT Chimaltenango</title>

  <!-- Estilos base (si ya tienes styles.css igual puedes dejarlo) -->
  <link rel="stylesheet" href="styles.css">

  <!-- Estilo específico de esta pantalla -->
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at 0 0, #28d7ff 0, #150027 45%, #050109 100%);
      color: #e8f9ff;
    }
    .app-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px 10px 40px;
    }
    .panel {
      width: 100%;
      max-width: 1300px;
      background: radial-gradient(circle at 10% 0, #072833 0, #050812 45%, #05010f 100%);
      border-radius: 28px;
      box-shadow: 0 0 40px rgba(0, 255, 255, 0.3);
      border: 2px solid rgba(0, 255, 255, 0.2);
      padding: 22px;
    }
    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
      margin-bottom: 18px;
    }
    .logo-box {
      width: 110px;
      height: 110px;
      border-radius: 26px;
      background: radial-gradient(circle at 30% 0, #00f7ff 0, #001016 45%, #000 100%);
      box-shadow: 0 0 25px rgba(0, 255, 255, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .logo-box img {
      width: 80%;
      height: 80%;
      object-fit: contain;
      filter: drop-shadow(0 0 10px #00faff);
    }
    .title-block {
      text-align: center;
      flex: 1;
    }
    .title-block h1 {
      margin: 0;
      font-size: 26px;
      letter-spacing: 0.15em;
      color: #4dffff;
      text-shadow: 0 0 12px #00f6ff;
    }
    .title-block .sub1 {
      margin-top: 8px;
      font-size: 14px;
      color: #9be5ff;
    }
    .title-block .sub2 {
      margin-top: 2px;
      font-size: 12px;
      color: #73ffd8;
    }
    .title-block .by {
      margin-top: 8px;
      font-size: 11px;
      letter-spacing: 0.25em;
      color: #ffb6ff;
      text-transform: uppercase;
    }

    /* Tabs superiores */
    .tabs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 16px;
      flex-wrap: wrap;
    }
    .tab-btn {
      border: none;
      border-radius: 999px;
      padding: 10px 22px;
      font-size: 14px;
      cursor: pointer;
      color: #e9f9ff;
      background: radial-gradient(circle at 0 0, #25334a 0, #050816 60%);
      box-shadow: 0 0 10px rgba(0,0,0,0.7);
      border: 1px solid rgba(0, 255, 255, 0.2);
      transition: transform 0.15s, box-shadow 0.15s, background 0.15s;
    }
    .tab-btn:hover {
      box-shadow: 0 0 16px rgba(0, 255, 255, 0.6);
      transform: translateY(-1px);
    }
    .tab-btn.active {
      background: linear-gradient(135deg, #00f5ff, #7a27ff);
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.9);
      color: #021018;
      font-weight: 600;
    }

    .meta-info {
      margin-top: 18px;
      font-size: 12px;
      color: #9dd4ff;
    }
    .meta-info strong {
      color: #3dffff;
    }

    .section-box {
      margin-top: 16px;
      background: radial-gradient(circle at 0 0, #071824 0, #02030a 70%);
      border-radius: 22px;
      border: 1px solid rgba(0, 255, 255, 0.15);
      box-shadow: 0 0 25px rgba(0, 255, 255, 0.15);
      padding: 18px 18px 22px;
    }
    .section-title {
      font-size: 16px;
      margin: 0 0 12px;
      color: #46ffe6;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px 20px;
    }
    @media (max-width: 900px) {
      .panel {
        padding: 16px;
      }
      .panel-header {
        flex-direction: column;
      }
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 13px;
    }
    .field label {
      color: #a8d7ff;
    }
    .field input,
    .field select,
    .field textarea {
      background: #020510;
      border-radius: 999px;
      border: 1px solid #00f0ff55;
      padding: 8px 12px;
      color: #eaf8ff;
      font-size: 13px;
      outline: none;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
    }
    .field textarea {
      border-radius: 18px;
      min-height: 70px;
      resize: vertical;
    }
    .field input:focus,
    .field select:focus,
    .field textarea:focus {
      border-color: #00ffff;
      box-shadow: 0 0 16px rgba(0, 255, 255, 0.7);
    }
    .field-inline {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 10px;
    }
    @media (max-width: 700px) {
      .field-inline {
        grid-template-columns: 1fr;
      }
    }

    .actions-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 18px;
      align-items: center;
      justify-content: space-between;
    }
    .left-actions,
    .right-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }
    .btn {
      border: none;
      border-radius: 999px;
      padding: 10px 20px;
      font-size: 13px;
      cursor: pointer;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      transition: transform 0.15s, box-shadow 0.15s, filter 0.15s;
      white-space: nowrap;
    }
    .btn-primary {
      background: linear-gradient(135deg, #00f5ff, #7a27ff);
      color: #021018;
      box-shadow: 0 0 18px rgba(0, 255, 255, 0.9);
    }
    .btn-secondary {
      background: linear-gradient(135deg, #00ffc3, #00b3ff);
      color: #021018;
      box-shadow: 0 0 14px rgba(0, 255, 191, 0.8);
    }
    .btn-danger {
      background: linear-gradient(135deg, #ff4b4b, #ff0044);
      color: #fff4f4;
      box-shadow: 0 0 16px rgba(255, 0, 80, 0.9);
    }
    .btn:hover {
      filter: brightness(1.06);
      transform: translateY(-1px);
      box-shadow: 0 0 24px rgba(0, 255, 255, 1);
    }

    .select-month {
      background: #020510;
      color: #eaf8ff;
      border-radius: 999px;
      border: 1px solid #00f0ff55;
      padding: 8px 12px;
      font-size: 13px;
      outline: none;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
    }

    .table-box {
      margin-top: 18px;
      background: #030612;
      border-radius: 18px;
      border: 1px solid rgba(0,255,255,0.2);
      box-shadow: inset 0 0 25px rgba(0,255,255,0.15);
      overflow: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 900px;
      font-size: 12px;
    }
    thead {
      background: linear-gradient(90deg, #00ffc3, #00c2ff);
      color: #021018;
    }
    th, td {
      padding: 8px 10px;
      border-bottom: 1px solid rgba(0,255,255,0.08);
      text-align: left;
    }
    tbody tr:nth-child(even) {
      background: rgba(0, 255, 255, 0.03);
    }
    tbody tr:hover {
      background: rgba(0, 255, 255, 0.09);
    }

    .summary {
      margin-top: 10px;
      font-size: 12px;
      color: #9deaff;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: space-between;
    }

    footer {
      margin-top: 14px;
      text-align: center;
      font-size: 11px;
      color: #80f5ff;
    }
    footer span.brand {
      color: #00ffe0;
      font-weight: 600;
    }
  </style>

  <!-- Librería Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>

<body>
<div class="app-shell">
  <div class="panel">
    <header class="panel-header">
      <div class="logo-box">
        <img src="icons/icon-192.png" alt="GELM">
      </div>

      <div class="title-block">
        <h1>TRANSPORTES 2026 — PMT CHIMALTENANGO</h1>
        <div class="sub1">Unidad de Transportes — Subcomisario / Jefe de Transportes</div>
        <div class="sub2">Módulo profesional de registro de <strong>operativos</strong></div>
        <div class="by">== BY GELM ==</div>

        <!-- Tabs -->
        <div class="tabs">
          <button class="tab-btn" onclick="location.href='agen2026.html'">Agenda 2026</button>
          <button class="tab-btn active">Operativos</button>
          <button class="tab-btn" onclick="location.href='denuncias.html'">Denuncias</button>
          <button class="tab-btn" onclick="location.href='https://gelm2mil.github.io/gelm/'">Buscar</button>
          <button class="tab-btn" onclick="location.href='respaldos.html'">Respaldos</button>
        </div>
      </div>

      <div class="logo-box">
        <img src="icons/icon-192.png" alt="GELM">
      </div>
    </header>

    <div class="meta-info">
      Mostrando <strong><span id="total-operativos">0</span></strong> operativos.
      &nbsp;|&nbsp; Última actualización: <span id="ultima-actualizacion">—</span>
    </div>

    <!-- FORMULARIO -->
    <section class="section-box">
      <h2 class="section-title">Registro de operativos 2026</h2>

      <div class="form-grid">
        <div class="field">
          <label for="fecha">Fecha</label>
          <input id="fecha" type="date">
        </div>

        <div class="field field-inline">
          <div>
            <label for="horaInicio">Hora inicio</label>
            <input id="horaInicio" type="time">
          </div>
          <div>
            <label for="horaFin">Hora fin</label>
            <input id="horaFin" type="time">
          </div>
        </div>

        <div class="field">
          <label for="tipoOperativo">Tipo de operativo</label>
          <select id="tipoOperativo">
            <option value="Operativo">Operativo</option>
            <option value="Supervisión">Supervisión</option>
            <option value="Retén / Control">Retén / Control</option>
            <option value="Alcoholímetro">Alcoholímetro</option>
            <option value="Apoyo especial">Apoyo especial</option>
            <option value="Otros">Otros</option>
          </select>
        </div>

        <div class="field">
          <label for="lugarRuta">Lugar / ruta</label>
          <input id="lugarRuta" type="text" placeholder="Casco urbano, Interamericana, colonias, etc.">
        </div>

        <div class="field field-inline">
          <div>
            <label for="licenciasConsignadas">Licencias consignadas</label>
            <input id="licenciasConsignadas" type="number" min="0" value="0">
          </div>
          <div>
            <label for="vehiculosConsignados">Vehículos consignados</label>
            <input id="vehiculosConsignados" type="number" min="0" value="0">
          </div>
        </div>

        <div class="field">
          <label for="personalAsignado">Personal asignado (opcional)</label>
          <input id="personalAsignado" type="text" placeholder="Agentes, unidades, apoyo de otras dependencias">
        </div>

        <div class="field">
          <label for="detalle">Detalle / objetivo del operativo</label>
          <textarea id="detalle" placeholder="Objetivo, revisión, seguimiento, etc."></textarea>
        </div>

        <div class="field">
          <label for="variacion">Variación (cambios respecto al plan)</label>
          <textarea id="variacion" placeholder="Cambios de ruta, horario, puntos de control, etc."></textarea>
        </div>

        <div class="field">
          <label for="observaciones">Observaciones (motivo de consignaciones, resultados, etc.)</label>
          <textarea id="observaciones" placeholder="Motivo de consignaciones, hallazgos, situaciones especiales, etc."></textarea>
        </div>
      </div>

      <div class="actions-row">
        <div class="left-actions">
          <button class="btn btn-primary" id="btn-agregar">Agregar operativo</button>
        </div>
        <div class="right-actions">
          <label style="font-size:12px;color:#9ad7ff">Ver mes:&nbsp;
            <select id="filtroMes" class="select-month">
              <option value="0">Todos</option>
              <option value="1">Enero</option>
              <option value="2">Febrero</option>
              <option value="3">Marzo</option>
              <option value="4">Abril</option>
              <option value="5">Mayo</option>
              <option value="6">Junio</option>
              <option value="7">Julio</option>
              <option value="8">Agosto</option>
              <option value="9">Septiembre</option>
              <option value="10">Octubre</option>
              <option value="11">Noviembre</option>
              <option value="12">Diciembre</option>
            </select>
          </label>

          <button class="btn btn-secondary" id="btn-excel">Descargar Excel</button>
          <button class="btn btn-danger" id="btn-borrar">Borrar todo (año 2026)</button>
        </div>
      </div>
    </section>

    <!-- TABLA -->
    <section class="section-box">
      <div class="table-box">
        <table>
          <thead>
          <tr>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Tipo</th>
            <th>Lugar / ruta</th>
            <th>Licencias</th>
            <th>Vehículos</th>
            <th>Variación</th>
            <th>Observaciones</th>
          </tr>
          </thead>
          <tbody id="tabla-operativos">
          </tbody>
        </table>
      </div>

      <div class="summary">
        <div>
          Total de operativos: <strong><span id="sum-operativos">0</span></strong>
          &nbsp;|&nbsp; Licencias consignadas: <strong><span id="sum-licencias">0</span></strong>
          &nbsp;|&nbsp; Vehículos consignados: <strong><span id="sum-vehiculos">0</span></strong>
        </div>
      </div>
    </section>

    <footer>
      2026 | <span class="brand">BY GELM</span> | Unidad de Transportes PMT — Chimaltenango
    </footer>
  </div>
</div>

<script>
  const STORAGE_KEY = 'operativos2026';

  let operativos = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

  const tablaBody = document.getElementById('tabla-operativos');
  const totalOperativosSpan = document.getElementById('total-operativos');
  const sumOperativosSpan = document.getElementById('sum-operativos');
  const sumLicenciasSpan = document.getElementById('sum-licencias');
  const sumVehiculosSpan = document.getElementById('sum-vehiculos');
  const ultimaActSpan = document.getElementById('ultima-actualizacion');
  const filtroMes = document.getElementById('filtroMes');

  function formatearFechaISOaLatam(iso) {
    if (!iso) return '';
    const d = new Date(iso);
    if (isNaN(d.getTime())) return '';
    const dia = String(d.getDate()).padStart(2,'0');
    const mes = String(d.getMonth()+1).padStart(2,'0');
    const anio = d.getFullYear();
    return `${dia}/${mes}/${anio}`;
  }

  function guardar() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(operativos));
    ultimaActSpan.textContent = new Date().toLocaleString('es-GT');
  }

  function render() {
    tablaBody.innerHTML = '';
    const mesFiltro = parseInt(filtroMes.value, 10);

    let filtrados = operativos;
    if (mesFiltro > 0) {
      filtrados = operativos.filter(op => {
        if (!op.fecha) return false;
        const d = new Date(op.fecha);
        return !isNaN(d.getTime()) && (d.getMonth() + 1) === mesFiltro;
      });
    }

    filtrados.forEach(op => {
      const tr = document.createElement('tr');

      const fechaLatam = formatearFechaISOaLatam(op.fecha);

      tr.innerHTML = `
        <td>${fechaLatam}</td>
        <td>${op.horaInicio || ''} - ${op.horaFin || ''}</td>
        <td>${op.tipoOperativo || ''}</td>
        <td>${op.lugarRuta || ''}</td>
        <td>${op.licenciasConsignadas ?? 0}</td>
        <td>${op.vehiculosConsignados ?? 0}</td>
        <td>${op.variacion || ''}</td>
        <td>${op.observaciones || ''}</td>
      `;
      tablaBody.appendChild(tr);
    });

    totalOperativosSpan.textContent = operativos.length;
    sumOperativosSpan.textContent = operativos.length;
    sumLicenciasSpan.textContent = operativos.reduce((a,o)=>a+(Number(o.licenciasConsignadas)||0),0);
    sumVehiculosSpan.textContent = operativos.reduce((a,o)=>a+(Number(o.vehiculosConsignados)||0),0);
  }

  document.getElementById('btn-agregar').addEventListener('click', () => {
    const fecha = document.getElementById('fecha').value;
    const horaInicio = document.getElementById('horaInicio').value;
    const horaFin = document.getElementById('horaFin').value;
    const tipoOperativo = document.getElementById('tipoOperativo').value;
    const lugarRuta = document.getElementById('lugarRuta').value.trim();
    const licenciasConsignadas = Number(document.getElementById('licenciasConsignadas').value || 0);
    const vehiculosConsignados = Number(document.getElementById('vehiculosConsignados').value || 0);
    const personalAsignado = document.getElementById('personalAsignado').value.trim();
    const detalle = document.getElementById('detalle').value.trim();
    const variacion = document.getElementById('variacion').value.trim();
    const observaciones = document.getElementById('observaciones').value.trim();

    if (!fecha) {
      alert('Por favor ingresa la fecha del operativo.');
      return;
    }

    operativos.push({
      fecha,
      horaInicio,
      horaFin,
      tipoOperativo,
      lugarRuta,
      licenciasConsignadas,
      vehiculosConsignados,
      personalAsignado,
      detalle,
      variacion,
      observaciones
    });

    guardar();
    render();

    document.getElementById('observaciones').value = '';
    document.getElementById('variacion').value = '';
    document.getElementById('detalle').value = '';
  });

  document.getElementById('btn-excel').addEventListener('click', () => {
    if (operativos.length === 0) {
      alert('No hay operativos para exportar.');
      return;
    }

    const data = operativos.map(op => ({
      'Fecha': formatearFechaISOaLatam(op.fecha),
      'Hora inicio': op.horaInicio || '',
      'Hora fin': op.horaFin || '',
      'Tipo operativo': op.tipoOperativo || '',
      'Lugar / ruta': op.lugarRuta || '',
      'Licencias consignadas': op.licenciasConsignadas ?? 0,
      'Vehículos consignados': op.vehiculosConsignados ?? 0,
      'Personal asignado': op.personalAsignado || '',
      'Detalle': op.detalle || '',
      'Variación': op.variacion || '',
      'Observaciones': op.observaciones || ''
    }));

    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.json_to_sheet(data);
    XLSX.utils.book_append_sheet(wb, ws, 'Operativos 2026');
    XLSX.writeFile(wb, 'operativos_2026_pmt_chimaltenango.xlsx');
  });

  document.getElementById('btn-borrar').addEventListener('click', () => {
    if (!confirm('¿Seguro que deseas borrar TODOS los registros de operativos 2026?')) return;
    operativos = [];
    guardar();
    render();
  });

  filtroMes.addEventListener('change', render);

  // init
  if (operativos.length && !ultimaActSpan.textContent.trim()) {
    ultimaActSpan.textContent = new Date().toLocaleString('es-GT');
  }
  render();
</script>
</body>
</html>
