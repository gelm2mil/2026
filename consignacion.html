<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>PMT CHIMALTENANGO - CONSIGNACIONES</title>
  <style>
    :root {
      --cyan: #00eaff;
      --bg: #020510;
      --card: rgba(10, 20, 40, 0.95);
    }

    body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; padding: 10px; }
    .container { max-width: 600px; margin: auto; }
    .panel { background: var(--card); border-radius: 15px; border: 1px solid rgba(0, 234, 255, 0.3); padding: 20px; }
    
    header { text-align: center; border-bottom: 2px solid var(--cyan); margin-bottom: 20px; padding-bottom: 10px; }
    .modulo { background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 10px; margin-bottom: 15px; }
    
    label { font-size: 11px; color: var(--cyan); display: block; margin-bottom: 5px; font-weight: bold; text-transform: uppercase; }
    input, textarea { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #333; background: #000; color: white; box-sizing: border-box; margin-bottom: 10px; font-size: 16px; }

    .btn-save { background: linear-gradient(135deg, #00eaff, #0099ff); color: black; padding: 15px; border: none; border-radius: 30px; width: 100%; font-weight: bold; cursor: pointer; font-size: 16px; margin-top: 10px; }
    
    /* Historial */
    .historial { margin-top: 30px; border-top: 1px solid #333; padding-top: 20px; }
    .item-registro { background: rgba(0, 234, 255, 0.1); padding: 12px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--cyan); }
    .btn-pdf { background: #b300ff; border: none; color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; }
    .btn-del { background: #ff4444; border: none; color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; margin-left: 5px; }

    /* Estilos para el PDF de Impresi칩n */
    #area-impresion { display: none; color: black; background: white; padding: 40px; }
    @media print {
      body * { visibility: hidden; }
      #area-impresion, #area-impresion * { visibility: visible; }
      #area-impresion { display: block; position: absolute; left: 0; top: 0; width: 100%; }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="panel">
    <header>
      <h2 style="margin:0;">PMT CHIMALTENANGO</h2>
      <small>UNIDAD DE TRANSPORTES - 2026</small>
    </header>

    <div class="modulo">
      <label>Datos del Conductor</label>
      <input type="text" id="conductor" placeholder="Nombre Completo">
      <label>Veh칤culo (Placa)</label>
      <input type="text" id="placas" placeholder="P-000XXX">
      <label>Fecha del Operativo</label>
      <input type="date" id="fecha">
      <label>Motivo</label>
      <textarea id="motivo" rows="2" placeholder="Escriba el motivo..."></textarea>
    </div>

    <button class="btn-save" onclick="guardarRegistro()">游 GUARDAR Y GENERAR BOLETA</button>

    <div class="historial">
      <h3 style="font-size: 14px; color: var(--cyan);">REGISTROS GUARDADOS (MEMORIA)</h3>
      <div id="listaRegistros"></div>
    </div>
  </div>
</div>

<div id="area-impresion">
  <div style="text-align:center; border-bottom: 2px solid black; padding-bottom: 10px;">
    <h2>POLIC칈A MUNICIPAL DE TR츼NSITO</h2>
    <h3>CHIMALTENANGO, GUATEMALA</h3>
    <p>BOLETA DE CONSIGNACI칍N DE VEH칈CULO</p>
  </div>
  <div style="padding: 20px 0; line-height: 1.6; font-size: 18px;">
    <p><b>FECHA:</b> <span id="p-fecha"></span></p>
    <p><b>CONDUCTOR:</b> <span id="p-conductor"></span></p>
    <p><b>PLACA:</b> <span id="p-placa"></span></p>
    <p><b>MOTIVO:</b> <br><span id="p-motivo"></span></p>
  </div>
  <div style="margin-top: 100px; display: flex; justify-content: space-between;">
    <div style="text-align: center; width: 45%; border-top: 1px solid black;">Firma Agente PMT</div>
    <div style="text-align: center; width: 45%; border-top: 1px solid black;">Firma Conductor</div>
  </div>
</div>

<script>
  const DB_NAME = "PMT_Data_Storage_2026";

  // Al cargar la p치gina, dibujar la lista
  window.onload = () => {
    document.getElementById('fecha').valueAsDate = new Date();
    mostrarHistorial();
  };

  function guardarRegistro() {
    const conductor = document.getElementById('conductor').value;
    const placa = document.getElementById('placas').value;
    const fecha = document.getElementById('fecha').value;
    const motivo = document.getElementById('motivo').value;

    if (!placa || !conductor) return alert("Llena los campos obligatorios");

    const registro = { id: Date.now(), conductor, placa, fecha, motivo };

    // Guardar
    let historial = JSON.parse(localStorage.getItem(DB_NAME) || "[]");
    historial.push(registro);
    localStorage.setItem(DB_NAME, JSON.stringify(historial));

    // Limpiar campos
    document.getElementById('conductor').value = "";
    document.getElementById('placas').value = "";
    document.getElementById('motivo').value = "";

    // Actualizar lista e Imprimir
    mostrarHistorial();
    imprimirBoleta(registro);
  }

  function mostrarHistorial() {
    const contenedor = document.getElementById('listaRegistros');
    let historial = JSON.parse(localStorage.getItem(DB_NAME) || "[]");
    
    contenedor.innerHTML = historial.length === 0 ? "<small>No hay registros guardados.</small>" : "";

    // Mostrar de m치s nuevo a m치s viejo
    historial.reverse().forEach(reg => {
      const card = document.createElement('div');
      card.className = 'item-registro';
      card.innerHTML = `
        <div>
          <strong>${reg.placa}</strong><br>
          <small>${reg.fecha}</small>
        </div>
        <div>
          <button class="btn-pdf" onclick='reimprimir(${reg.id})'>PDF</button>
          <button class="btn-del" onclick="borrarRegistro(${reg.id})">X</button>
        </div>
      `;
      contenedor.appendChild(card);
    });
  }

  function imprimirBoleta(obj) {
    document.getElementById('p-fecha').innerText = obj.fecha;
    document.getElementById('p-conductor').innerText = obj.conductor;
    document.getElementById('p-placa').innerText = obj.placa;
    document.getElementById('p-motivo').innerText = obj.motivo;
    window.print();
  }

  function reimprimir(id) {
    let historial = JSON.parse(localStorage.getItem(DB_NAME) || "[]");
    let reg = historial.find(x => x.id === id);
    if (reg) imprimirBoleta(reg);
  }

  function borrarRegistro(id) {
    if (confirm("쮼liminar este registro permanentemente?")) {
      let historial = JSON.parse(localStorage.getItem(DB_NAME) || "[]");
      historial = historial.filter(x => x.id !== id);
      localStorage.setItem(DB_NAME, JSON.stringify(historial));
      mostrarHistorial();
    }
  }
</script>

</body>
</html>
