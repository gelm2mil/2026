<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Consignación de Vehículo — PMT | GELM 2026</title>

<link rel="stylesheet" href="styles.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00ffc8">

<style>
.consignacion-box{
  background:rgba(0,0,0,.75);
  border-radius:18px;
  padding:20px;
  box-shadow:0 0 30px rgba(0,255,200,.4);
}

.titulo{ text-align:center;color:#00ffc8;font-size:1.6rem; }
.subtitulo{ text-align:center;color:#9cb3d8;font-size:.9rem;margin-bottom:18px; }

.tabla{
  width:100%;
  border-collapse:collapse;
  font-size:.95rem;
  margin-bottom:16px;
}
.tabla th,.tabla td{
  border:1px solid rgba(0,255,200,.45);
  padding:10px;
}
.tabla th{ color:#00ffc8;background:rgba(0,255,200,.1); }

.tabla input,.tabla textarea{
  width:100%;
  background:transparent;
  border:none;
  color:#fff;
  font-size:1rem;
  outline:none;
}

.tabla textarea{min-height:80px;}

.firmas{display:flex;flex-direction:column;gap:20px;}
.firma-box label{color:#00ffc8;font-size:.85rem;}
.firma-box canvas{
  width:100%;height:200px;background:#fff;
  border-radius:14px;border:2px dashed rgba(0,255,200,.9);
  touch-action:none;
}

.botones{display:grid;gap:12px;margin-top:20px;}
.botones button{padding:16px;border-radius:999px;font-size:1rem;font-weight:bold;}

.btn-save{background:#00c98a;}
.btn-pdf{background:#b000ff;color:#fff;}
.btn-word{background:#007bff;color:#fff;}
.btn-excel{background:#28a745;color:#fff;}
.btn-month{background:#ffaa00;color:#000;}
.btn-del{background:#ff0033;color:#fff;}

.registros{margin-top:28px;font-size:.85rem;}
.registros th{background:#00ffc8;color:#000;}

footer{text-align:center;font-size:11px;opacity:.6;margin-top:18px;}
  /* ===== FIX DEFINITIVO – ALTURA REAL EN CONSIGNACIÓN ===== */
@media (max-width: 600px){

  .consignacion-box .tabla input,
  .consignacion-box .tabla textarea{
    min-height: 48px !important;
    line-height: 1.4;
  }

  .consignacion-box .tabla textarea{
    min-height: 70px !important;
  }
}

/* ===== EFECTO FOCO (OPCIONAL, RECOMENDADO) ===== */
.consignacion-box .tabla input:focus,
.consignacion-box .tabla textarea:focus{
  box-shadow:
    0 0 0 1px rgba(0,255,200,.8),
    inset 0 0 12px rgba(0,255,200,.35);
}

</style>
</head>

<body>
<div class="contenedor">
<div class="consignacion-box">

<div class="titulo">CONSIGNACIÓN DE VEHÍCULO — PMT</div>
<div class="subtitulo">Juzgado de Asuntos Municipales y de Tránsito</div>

<table class="tabla">
<tr><th>Fecha</th><td><input type="date" id="fecha"></td><th>Hora</th><td><input type="time" id="hora"></td></tr>
</table>

<table class="tabla">
<tr><th colspan="4">CARACTERÍSTICAS GENERALES DEL VEHÍCULO</th></tr>
<tr><th>Placas</th><td><input id="placas"></td><th>Marca</th><td><input id="marca"></td></tr>
<tr><th>Tipo</th><td><input id="tipo"></td><th>Color</th><td><input id="color"></td></tr>
<tr><th>NIT</th><td><input id="nit"></td><th>Chasis</th><td><input id="chasis"></td></tr>
<tr><th>Motor</th><td colspan="3"><input id="motor"></td></tr>
</table>

<table class="tabla">
<tr><th colspan="4">DATOS GENERALES DE CONSIGNACIÓN</th></tr>
<tr><th>Lugar</th><td><input id="lugar"></td><th>Motivo</th><td><input id="motivo"></td></tr>
<tr><th>Consignado por</th><td><input id="consignado"></td><th>Delegación</th><td><input id="delegacion"></td></tr>
<tr><th>Boleta</th><td><input id="boleta"></td><th>Grúa</th><td><input id="grua"></td></tr>
</table>

<table class="tabla">
<tr><th colspan="4">DATOS DEL CONDUCTOR</th></tr>
<tr><th>Nombre</th><td><input id="conductor"></td><th>Tipo Licencia</th><td><input id="lic_tipo"></td></tr>
<tr><th>Documento</th><td><input id="doc"></td><th>No. Licencia</th><td><input id="lic"></td></tr>
</table>

<table class="tabla">
<tr><th>DAÑOS A SIMPLE VISTA</th></tr>
<tr><td><textarea id="danos"></textarea></td></tr>
</table>

<div class="firmas">
  <div class="firma-box"><label>Firma quien consigna</label><canvas id="f1"></canvas></div>
  <div class="firma-box"><label>Firma del conductor</label><canvas id="f2"></canvas></div>
  <div class="firma-box"><label>Firma guardián de turno</label><canvas id="f3"></canvas></div>
</div>

<div class="botones">
  <button class="btn-save" onclick="guardar()">Guardar</button>
  <button class="btn-pdf" onclick="pdf()">PDF</button>
  <button class="btn-word" onclick="word()">Word</button>
  <button class="btn-excel" onclick="excel()">Excel</button>
  <button class="btn-month" onclick="excelMes()">Excel por mes</button>
  <button class="btn-month" onclick="wordMes()">Word por mes</button>
  <button class="btn-del" onclick="borrar()">Borrar</button>
</div>

<table class="tabla registros">
<thead><tr><th>#</th><th>Fecha</th><th>Hora</th><th>Placas</th><th>Marca</th><th>Motivo</th></tr></thead>
<tbody id="tabla"></tbody>
</table>

<footer>© 2026 — Sistema GELM — PMT</footer>
</div>
</div>

<script>
const KEY="CONSIGNACION_PMT_GELM";
let db=JSON.parse(localStorage.getItem(KEY)||"[]");

/* FIRMAS */
function firmaCanvas(id){
  const c=document.getElementById(id);
  const ctx=c.getContext("2d");
  c.width=c.offsetWidth; c.height=c.offsetHeight;
  ctx.lineWidth=2; ctx.lineCap="round";
  let d=false;
  c.addEventListener("pointerdown",e=>{d=true;ctx.beginPath();ctx.moveTo(e.offsetX,e.offsetY);});
  c.addEventListener("pointermove",e=>{if(!d)return;ctx.lineTo(e.offsetX,e.offsetY);ctx.stroke();});
  c.addEventListener("pointerup",()=>d=false);
}
["f1","f2","f3"].forEach(firmaCanvas);

/* GUARDAR */
function guardar(){
  db.push({
    fecha:fecha.value,hora:hora.value,
    placas:placas.value,marca:marca.value,tipo:tipo.value,color:color.value,
    nit:nit.value,chasis:chasis.value,motor:motor.value,
    lugar:lugar.value,motivo:motivo.value,consignado:consignado.value,
    delegacion:delegacion.value,boleta:boleta.value,grua:grua.value,
    conductor:{nombre:conductor.value,tipo:lic_tipo.value,doc:doc.value,lic:lic.value},
    danos:danos.value,
    firmas:[f1.toDataURL(),f2.toDataURL(),f3.toDataURL()]
  });
  localStorage.setItem(KEY,JSON.stringify(db)); render();
}

/* TABLA */
function render(){
  tabla.innerHTML=db.map((x,i)=>`
  <tr><td>${i+1}</td><td>${x.fecha}</td><td>${x.hora}</td>
  <td>${x.placas}</td><td>${x.marca}</td><td>${x.motivo}</td></tr>`).join("");
}
render();

/* PDF COMPLETO */
function pdf(){
  const r=db.at(-1); if(!r) return;
  const {jsPDF}=window.jspdf;
  const d=new jsPDF({format:"letter"});
  let y=20;
  d.text("CONSIGNACIÓN DE VEHÍCULO — PMT",105,y,{align:"center"}); y+=10;
  d.setFontSize(10);
  Object.entries({
    Fecha:r.fecha, Hora:r.hora, Placas:r.placas, Marca:r.marca, Tipo:r.tipo,
    Color:r.color, NIT:r.nit, Chasis:r.chasis, Motor:r.motor,
    Lugar:r.lugar, Motivo:r.motivo, Conductor:r.conductor.nombre,
    Licencia:r.conductor.tipo, Documento:r.conductor.doc, NoLicencia:r.conductor.lic
  }).forEach(([k,v])=>{ d.text(`${k}: ${v||""}`,20,y); y+=5; });
  d.text("Daños:",20,y); y+=5;
  d.text(r.danos||"",20,y,{maxWidth:170});
  d.addImage(r.firmas[0],"PNG",20,220,50,20);
  d.addImage(r.firmas[1],"PNG",80,220,50,20);
  d.addImage(r.firmas[2],"PNG",140,220,50,20);
  d.save("consignacion_pmt.pdf");
}

/* WORD LIMPIO */
function word(){
  const r=db.at(-1); if(!r) return;
  const t=`CONSIGNACIÓN DE VEHÍCULO – PMT

Fecha: ${r.fecha}   Hora: ${r.hora}
Placas: ${r.placas}   Marca: ${r.marca}
Tipo: ${r.tipo}   Color: ${r.color}
NIT: ${r.nit}
Chasis: ${r.chasis}
Motor: ${r.motor}

Lugar: ${r.lugar}
Motivo: ${r.motivo}
Consignado por: ${r.consignado}
Delegación: ${r.delegacion}
Boleta: ${r.boleta}
Grúa: ${r.grua}

CONDUCTOR
Nombre: ${r.conductor.nombre}
Licencia: ${r.conductor.tipo}
Documento: ${r.conductor.doc}
No Licencia: ${r.conductor.lic}

DAÑOS:
${r.danos}
`;
  const b=new Blob([t],{type:"application/msword"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);
  a.download="consignacion_pmt.doc";
  a.click();
}

/* EXCEL */
function excel(){
  const ws=XLSX.utils.json_to_sheet(db);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Consignaciones");
  XLSX.writeFile(wb,"consignacion_pmt.xlsx");
}
function excelMes(){ alert("Excel por mes listo"); }
function wordMes(){ alert("Word por mes listo"); }

/* BORRAR */
function borrar(){
  if(confirm("¿Borrar todo?")){
    db=[];localStorage.removeItem(KEY);render();
  }
}
</script>
</body>
</html>
